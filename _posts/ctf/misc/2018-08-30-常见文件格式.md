---
layout: post
title: "常见文件格式"
date: 2018-08-30 16:54:13 +0800
description: ""
category: ctf/misc
tags: []
---

#### [文件头文件尾总结](https://www.cnblogs.com/lwy-kitty/p/3928317.html)

| 文件格式                    | 文件头                                                    | 文件尾                                        |
| --------------------------- | --------------------------------------------------------- | --------------------------------------------- |
| JPEG (jpg)                  | FF D8 FF E1                                               | FF D9                                         |
| PNG (png)                   | 89 50 4E 47 0D 0A 1A 0A(\x89PNG)                          | 00 00 00 00 49 45 4E 44 AE 42 60 82(\x00IEND) |
| GIF (gif)                   | 47 49 46 38(GIF8)                                         | 00 3B                                         |
| TIFF (tif)                  | 49 49 2A 00(II*\x00)                                      |                                               |
| Windows Bitmap (bmp)        | 42 4D(BM)                                                 |                                               |
| ZIP Archive (zip)           | 50 4B 03 04(PK\x03\x04)                                   |                                               |
| RAR Archive (rar)           | 52 61 72 21(Rar!)                                         |                                               |
| zlib                        | 78 9C(x\x9c)                                              |                                               |
| gzip                        | 1F 8B 08                                                  |                                               |
| lzma                        | 6C 00                                                     |                                               |
| Lua bytecode (luac)         | 1B 4C 74 61 5*(\x1bLuaQ\|R\|S)                            |                                               |
| Lua JIT bytecode (luac)     | 1B 4C 4A(\x1bLJ)                                          |                                               |
| Win executable file (exe)   | 4D 5A(MZ)                                                 |                                               |
| Linux executable file (elf) | 7F 45 4C 46(\x7fELF)                                      |                                               |
| Wave (wav)                  | 57 41 56 45(WAVE)                                         |                                               |
| AVI (avi)                   | 41 56 49 20(AVI )                                         |                                               |
| Real Audio (ram)            | 2E 72 61 FD(.ra\xfd)                                      |                                               |
| Real Media (rm)             | 2E 52 4D 46(.RMF)                                         |                                               |
| MPEG (mpg)                  | 00 00 01 [BA \| B3]                                       |                                               |
| Quicktime (mov)             | 6D 6F 6F 76(moov)                                         |                                               |
| Windows Media (asf)         | 30 26 B2 75 8E 66 CF 11(0&\xb2u\x8ef\xcf\x11)             |                                               |
| MIDI (mid)                  | 4D 54 68 64(MThd)                                         |                                               |
| CAD (dwg)                   | 41 43 31 30(AC10)                                         |                                               |
| Adobe Photoshop (psd)       | 38 42 50 53(8BPS)                                         |                                               |
| Rich Text Format (rtf)      | 7B 5C 72 74 66({\\rtf)                                    |                                               |
| XML (xml)                   | 3C 3F 78 6D 6C(<?xml)                                     |                                               |
| HTML (html)                 | 3C 68 74 6D 6C 3E(\<html\>)                               |                                               |
| Email [thorough only] (eml) | 44 65 6C 69 76 65 72 79 2D 64 61 74 65 3A(Delivery-date:) |                                               |
| Outlook Express (dbx)       | CF AD 12 FE C5 FD 74 6F                                   |                                               |
| Outlook (pst)               | 21 42 44 4E(!BDN)                                         |                                               |
| MS Word/Excel (xls.or.doc)  | D0 CF 11 E0                                               |                                               |
| MS Access (mdb)             | 53 74 61 6E 64 61 72 64 20 4A(Standard J)                 |                                               |
| WordPerfect (wpd)           | FF 57 50 43(\xffWPC)                                      |                                               |
| Adobe Acrobat (pdf)         | 25 50 44 46 2D 31 2E(%PDF-1.)                             |                                               |
| Quicken (qdf)               | AC 9E BD 8F                                               |                                               |
| Windows Password (pwl)      | E3 82 85 96                                               |                                               |
| RSA Private binary(pem)     | 30 82 02 5C (后接0x025C=604byte)                          |                                               |

#### [PNG文件格式](https://ctf-wiki.github.io/ctf-wiki/misc/picture/png/)

- 文件头 `89 50 4E 47 0D 0A 1A 0A` + 数据块 + 数据块 + 数据块 ...

- 每个数据块由4部分组成：

| 名称                            | 字节数   | 说明                                                  |
| ------------------------------- | -------- | ----------------------------------------------------- |
| Length（长度）                  | 4 字节   | 指定数据块中数据域的长度，其长度不超过（2^31－1）字节 |
| Chunk Type Code（数据块类型码） | 4 字节   | 数据块类型码由 ASCII 字母（A - Z 和 a - z）组成       |
| Chunk Data（数据块数据）        | 可变长度 | 存储按照 Chunk Type Code 指定的数据                   |
| CRC（循环冗余检测）             | 4 字节   | 存储用来检测是否有错误的循环冗余码                    |

CRC（Cyclic Redundancy Check）域中的值是对`Chunk Type Code`域和`Chunk Data`域中的数据进行CRC32计算得到的。某IHDR头数据块`00 00 00 0d 49 48 44 52 00 00 00 1e 00 00 00 05 01 03 00 00 00 68 ef ce b9`，Length=0x0d，ChunkTypeCode=`49 48 44 52`即IHDR，ChunkData是长度为0x0d的数据：`00 00 00 1e 00 00 00 05 01 03 00 00 00`，将ChunkTypeCode和ChunkData计算得到CRC=`68 ef ce b9`：

```python
hex(zlib.crc32('494844520000001e000000050103000000'.decode('hex')) & 0xffffffff) #'0x68efceb9L'
```

- 关键数据块（critical chunk）有3种：IHDR（头数据块）、IDAT（图像数据块）、IEND（结束数据块）

  IDAT采用`LZ77`算法的派生算法进行压缩，在数据流中可包含多个连续顺序的图像数据块，**只有当上一个块充满时，才会继续一个新的块**。可以用`zlib.decompress`进行解压缩。





